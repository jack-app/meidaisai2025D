- [ディレクトリ構成](#ディレクトリ構成)
- [開発のヒント](#開発のヒント)
  - [自動ビルド](#自動ビルド)
  - [ルーティング（エンドポイントの設定）](#ルーティングエンドポイントの設定)
  - [テスト](#テスト)
    - [（RESTful APIの）インタラクティブなテスト](#restful-apiのインタラクティブなテスト)
    - [単体テストの配置](#単体テストの配置)
    - [全テストを実行したいとき](#全テストを実行したいとき)
    - [特定のディレクトリ内のテストを実行したいとき](#特定のディレクトリ内のテストを実行したいとき)
    - [クライアント（フロントエンド）としてテストしたいとき](#クライアントフロントエンドとしてテストしたいとき)

# ディレクトリ構成

- src/: バックエンドの開発では，このディレクトリを**編集します**．
- lib/: ビルド結果が格納されます．直接編集することはありません．
- node_modules/: 依存ライブラリが格納されます．`npm install`で作成されます．直接編集することはありません．
- .gitignore: 設定ファイルです．普通編集しません．
- package.json: 設定ファイルです．普通編集しません．
- package-lock.json: npmによって自動で生成されるファイルです．直接編集することはありません．
- tsconfig.json: 設定ファイルです．普通編集しません．

# 開発のヒント

## 自動ビルド

作成したコードを動作させるために，**ビルド**が必要です．
(カレントディレクトリを`functions`にして)
`npm run build`でビルドできますが，変更のたびにこのコマンドを実行するのは面倒です．

そこで，`npm run build:watch`と実行することで，変更を監視し，変更があれば自動でビルドが走るようにできます．
変更の監視を停止するときは，`npm run build:watch`を実行したターミナルで"Ctrl+C"か，バツボタンでターミナルを閉じます．

## ルーティング（エンドポイントの設定）

`functions/src/index.ts`を編集します．

仮に静的コンテンツ（フロントエンド）と動的コンテンツ（バックエンド）で重複するエンドポイント（ルーティング）があった場合，静的コンテンツのほうが優先されるので注意してください．
エンドポイント`/`と`/assets/**`はフロントエンドで使用されています．
他にも，`../frontend/public`に配置されたファイルは`../public`にも配置されるので，そのファイルと同名のエンドポイントを使用することはできません．

## テスト

### （RESTful APIの）インタラクティブなテスト

[shellモードを用います．](https://firebase.google.com/docs/functions/local-shell?hl=ja)

### 単体テストの配置

`xxx.test.ts`としてテストを配置してください．
ファイル名の末尾は必ず`.test.ts`である必要があります．

### 全テストを実行したいとき

(カレントディレクトリを`functions`にして)
`npm test`

### 特定のディレクトリ内のテストを実行したいとき

(カレントディレクトリを`functions`にして)
`npm test <ここにディレクトリのパス>`

例えば，functions/src/views内のテストのみ実行したい場合は`npm test views`とします．
詳細は`npx vitest --help`で確認することもできます．

### クライアント（フロントエンド）としてテストしたいとき

1. テストの配置
`test-client`パッケージを編集してください．

2. ローカルサーバの起動
ターミナルを開いて，プロジェクトルートで以下のコマンドを実行してください．
```
firebase emulators:start
```
しばらく待つと"Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files."と表示されたら起動完了です．

3. テストの実行
カレントディレクトリを`test-client`にして`npm test`を実行すると，すべてのクライアントサイドテストが走ります．

参考: https://zenn.dev/nananaoto/articles/9bff8b9eca891656c110

